<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <body>
    <button onclick="Ludbud.oauth('dropbox');">Connect to Dropbox!</button>
    <button onclick="Ludbud.oauth('googledrive');">Connect to Google Drive!</button>
    <button onclick="Ludbud.oauth('remotestorage', document.getElementById('user-address').value);">Connect to your remoteStorage:</button>
    <input id="user-address" placeholder="user@provider.com" value="michiel2@5apps.com" />
    <button onclick="reset();">Disconnect!</button>
  </body>
  <script src="https://raw.githubusercontent.com/mozilla/localforage/master/dist/localforage.min.js"></script>
  <script src="./ludbud.js"></script>
  <script>
    Ludbud.setApiCredentials('dropbox', 'cybbbiarf4dkrce');
    Ludbud.setApiCredentials('googledrive', '709507725318-3mt4ke1d4tvkc7ktbjvru3csif4nsk67.apps.googleusercontent.com');
    function getUserDataCredentials(callback) {
      var harvest = Ludbud.fromWindowLocation();
      if (harvest) {
        console.log('setting harvest into localforage, then reloading page', harvest);
        localforage.setItem('userDataCredentials', harvest, function(err) {
          Ludbud.restoreWindowLocation();
          //now the page will be reloaded, after which harvest will be undefined
        });
      } else {
        localforage.getItem('userDataCredentials', callback);
      }
    }
    getUserDataCredentials(function(err, userDataCredentials) {
      if (err) {
        console.log('error getting user data credentials', err);
      } else if (userDataCredentials) {
        var ludbud = new Ludbud(userDataCredentials);
        console.log('now we can use this ludbud object to access the user\'s data');
        ludbud.getInfo('/', function(err, info) {
          console.log(err, info);
        });
      } else {
        console.log('No user data credentials yet. Please click one of the buttons');
      }
    });
    function reset() {
      localforage.clear(function() {
        window.location = window.location.href;
      });
    }
  </script>
</html>
